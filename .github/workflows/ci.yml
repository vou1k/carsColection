name: C++ CI/CD Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-and-test:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Build project
      run: |
        echo "=== Building Car Collection on Windows ==="
        g++ --version
        g++ -std=c++17 -Wall -Wextra -pedantic -o car_collection.exe main.cpp CarCollection.cpp
        
        if (Test-Path "car_collection.exe") {
          echo "Build SUCCESS!"
          echo "File size: $((Get-Item car_collection.exe).Length) bytes"
          dir car_collection.exe
        } else {
          echo "Build FAILED!"
          exit 1
        }
    
    - name: Run basic test
      run: |
        echo "=== Testing program ==="
        ./car_collection.exe --help 2>&1 | Select-Object -First 5
        echo "Program compiled and ran successfully"
    
    - name: Upload build artifact
      uses: actions/upload-artifact@v4
      with:
        name: car-collection-windows
        path: car_collection.exe
